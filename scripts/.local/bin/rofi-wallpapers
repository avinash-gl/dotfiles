#!/usr/bin/env bash

WALL_DIR="$HOME/wallpapers"
THEME_FILE="$HOME/.config/rofi/theme.rasi"

# Generate list with image previews
wallpaper=$(find -L "$WALL_DIR" -maxdepth 1 -type f \( -iname "*.jpg" -o -iname "*.png" -o -iname "*.jpeg" \) \
    -printf "%f\n" | shuf | while read -r wp; do
        printf "%s\0icon\x1f%s/%s\n" "$wp" "$WALL_DIR" "$wp"
    done | rofi -dmenu \
        -p "" \
        -show-icons \
        -theme "$THEME_FILE" \
        -theme-str '
        inputbar {border:0px;}
        entry {enabled: false;}
        prompt {enabled: false;}
        window {width: 600px; height: 600px;}
         element-icon {padding: 0; margin: 0; size: 500 px;}
         element-text {enabled: false; color: transparent; } 
         listview {lines: 1; fixed-height: true; padding: 0;}
         element {padding: 0px; margin: 25px;}
         element selected.normal { border: 0;}
         ')

[ -z "$wallpaper" ] && exit

# Select theme mode
mode=$(printf "Light\nDark" | rofi -dmenu -theme "$THEME_FILE" -p "")
[ -z "$mode" ] && exit

# Apply wallpaper with theme
if [ "$mode" = "Light" ]; then
    wal -l -i "$WALL_DIR/$wallpaper"
else
    wal -i "$WALL_DIR/$wallpaper"
fi 
